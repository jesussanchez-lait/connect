rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas para usuarios
    match /users/{userId} {
      // Usuarios autenticados (incluyendo anónimos) pueden leer y escribir su propio documento
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Lectura pública por documentNumber (solo campos no sensibles)
      // Esto permite que la página [documentNumber] funcione sin autenticación
      allow read: if request.auth == null && 
        resource.data.documentNumber != null &&
        resource.data.role == 'FOLLOWER';
    }
    
    // Reglas para campañas
    match /campaigns/{campaignId} {
      // Lectura pública de campañas (necesario para mostrar información en dashboards)
      allow read: if request.auth != null;
    }
    
    // Reglas para otros documentos (bloquear por defecto)
    match /{document=**} {
      allow read, write: if false;
    }
  }
}